<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.2 NULL values in aggregation | Data Manipulation with SQL</title>
  <meta name="description" content="This book introduces essential SQL commands for data maninpulation, as well as presenting equivalent dplyr code for complex queries." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="3.2 NULL values in aggregation | Data Manipulation with SQL" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces essential SQL commands for data maninpulation, as well as presenting equivalent dplyr code for complex queries." />
  <meta name="github-repo" content="enixam/data-manipulation-sql" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.2 NULL values in aggregation | Data Manipulation with SQL" />
  
  <meta name="twitter:description" content="This book introduces essential SQL commands for data maninpulation, as well as presenting equivalent dplyr code for complex queries." />
  

<meta name="author" content="Qiushi Yan" />


<meta name="date" content="2020-07-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-group-by-clause-.html"/>
<link rel="next" href="the-having-clause.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Manipulationn with SQL</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="basic-query.html"><a href="basic-query.html"><i class="fa fa-check"></i><b>1</b> Basic query</a></li>
<li class="chapter" data-level="2" data-path="filtering.html"><a href="filtering.html"><i class="fa fa-check"></i><b>2</b> Filtering</a><ul>
<li class="chapter" data-level="2.1" data-path="the-where-clause.html"><a href="the-where-clause.html"><i class="fa fa-check"></i><b>2.1</b> The <code>WHERE</code> clause</a></li>
<li class="chapter" data-level="2.2" data-path="operators.html"><a href="operators.html"><i class="fa fa-check"></i><b>2.2</b> Operators</a><ul>
<li class="chapter" data-level="2.2.1" data-path="operators.html"><a href="operators.html#comparison-operators"><i class="fa fa-check"></i><b>2.2.1</b> Comparison operators</a></li>
<li class="chapter" data-level="2.2.2" data-path="operators.html"><a href="operators.html#logical-operators"><i class="fa fa-check"></i><b>2.2.2</b> Logical operators</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="other-relational-operators.html"><a href="other-relational-operators.html"><i class="fa fa-check"></i><b>2.3</b> Other relational operators</a></li>
<li class="chapter" data-level="2.4" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>2.4</b> Missing values</a><ul>
<li class="chapter" data-level="2.4.1" data-path="missing-values.html"><a href="missing-values.html#conditional-functions"><i class="fa fa-check"></i><b>2.4.1</b> Conditional functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="aggregating.html"><a href="aggregating.html"><i class="fa fa-check"></i><b>3</b> Aggregating</a><ul>
<li class="chapter" data-level="3.1" data-path="the-group-by-clause-.html"><a href="the-group-by-clause-.html"><i class="fa fa-check"></i><b>3.1</b> The <code>GROUP BY</code> clause.</a></li>
<li class="chapter" data-level="3.2" data-path="null-values-in-aggregation.html"><a href="null-values-in-aggregation.html"><i class="fa fa-check"></i><b>3.2</b> NULL values in aggregation</a></li>
<li class="chapter" data-level="3.3" data-path="the-having-clause.html"><a href="the-having-clause.html"><i class="fa fa-check"></i><b>3.3</b> The <code>HAVING</code> clause</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="windows-functions.html"><a href="windows-functions.html"><i class="fa fa-check"></i><b>4</b> Windows functions</a><ul>
<li class="chapter" data-level="4.1" data-path="statisticcs-with-window-functions.html"><a href="statisticcs-with-window-functions.html"><i class="fa fa-check"></i><b>4.1</b> Statisticcs with window functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li>
  <a href="https://github.com/rstudio/bookdown" target="blank">Written with bookdown</a>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Manipulation with SQL</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="null-values-in-aggregation" class="section level2">
<h2><span class="header-section-number">3.2</span> NULL values in aggregation</h2>
<p>The <code>COUNT</code> function was designed to be consistent with these other aggregate functions
except in the case where you use <code>COUNT(*)</code>. So the general rule is that aggregate functions ignore <code>NULL</code> values, and the one exception to that rule is when you use <code>COUNT(*)</code>.</p>
<p>With some SQL engines, you can specify more than one column reference or expression after the <code>DISTINCT</code> keyword in the <code>COUNT</code> function. This returns the number of unique combinations of the specified columns that exist in the data. This works in Hive, Impala, and MySQL, but <strong>not</strong> in PostgreSQL.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb22-1"><a href="null-values-in-aggregation.html#cb22-1"></a><span class="co">-- this won&#39;t work in PostgreSQL</span></span>
<span id="cb22-2"><a href="null-values-in-aggregation.html#cb22-2"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> red, green, blue) <span class="kw">FROM</span> crayons</span></code></pre></div>
<p>Also, with some SQL engines, you can use more than one <code>COUNT(DISTINCT)</code> in a <code>SELECT</code> list,
like in this example which uses the crayons table.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb23-1"><a href="null-values-in-aggregation.html#cb23-1"></a><span class="co">-- PostgreSQL allows for multiple COUNT(DISTINCT) in one select list</span></span>
<span id="cb23-2"><a href="null-values-in-aggregation.html#cb23-2"></a><span class="kw">SELECT</span> </span>
<span id="cb23-3"><a href="null-values-in-aggregation.html#cb23-3"></a>  pack,</span>
<span id="cb23-4"><a href="null-values-in-aggregation.html#cb23-4"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> red) <span class="kw">AS</span> red_count,</span>
<span id="cb23-5"><a href="null-values-in-aggregation.html#cb23-5"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> green) <span class="kw">AS</span> green_count,</span>
<span id="cb23-6"><a href="null-values-in-aggregation.html#cb23-6"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> blue) <span class="kw">AS</span> blue_count</span>
<span id="cb23-7"><a href="null-values-in-aggregation.html#cb23-7"></a><span class="kw">FROM</span> crayons</span>
<span id="cb23-8"><a href="null-values-in-aggregation.html#cb23-8"></a><span class="kw">GROUP</span> <span class="kw">BY</span> pack</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-14">Table 3.6: </span>9 records</caption>
<thead>
<tr class="header">
<th align="right">pack</th>
<th align="right">red_count</th>
<th align="right">green_count</th>
<th align="right">blue_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">6</td>
<td align="right">8</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">24</td>
<td align="right">7</td>
<td align="right">8</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">32</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">48</td>
<td align="right">14</td>
<td align="right">16</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="right">64</td>
<td align="right">15</td>
<td align="right">15</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="right">96</td>
<td align="right">21</td>
<td align="right">27</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="right">120</td>
<td align="right">21</td>
<td align="right">22</td>
<td align="right">24</td>
</tr>
</tbody>
</table>
</div>
<p>Here, the COUNT function is used three separate times in the <code>SELECT</code> list and the <code>DISTINCT</code> keyword is included in all three. So the result set has three columns giving the number of unique values in the red column, the number of unique values in the green column, and the number of unique values in the blue column. But with some other SQL engines including Impala, you are limited to only one<code>COUNT(DISTINCT)</code> per <code>SELECT</code> list.</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-group-by-clause-.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-having-clause.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/enixam/data-manipulation-sql/edit/master/aggregating.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
